{# users/templates/users/create_pet_report.html #}
{% extends 'users/base.html' %}
{% load static %}

{% block title %}{{ report_type }} Pet Report{% endblock %}

{% block content %}
<section class="report-section">
  <div class="auth-box"> {# Reusing auth-box for form styling #}
    <h2 class="auth-title">{{ report_type }} Pet Report</h2>
    <p class="auth-subtitle">Help us reunite pets with their families!</p>

    {# IMPORTANT: enctype="multipart/form-data" is crucial for file uploads #}
    <form id="petReportForm" method="post" enctype="multipart/form-data" action="">
      {% csrf_token %}

      {# Display form errors #}
      {% if form.errors %}
        <div class="alert alert-danger">
          {% for field in form %}
            {% for error in field.errors %}
              <p><strong>{{ field.label }}:</strong> {{ error }}</p>
            {% endfor %}
          {% endfor %}
          {% for error in form.non_field_errors %}
            <p><strong>Error:</strong> {{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}

      {# Form fields - NEW FIELDS ADDED #}
      <div class="form-group">
        <label for="id_name">Pet's Name:</label>
        <input type="text" id="id_name" name="name" value="{{ form.name.value|default:'' }}">
      </div>
      <div class="form-group">
        <label for="id_age">Age (Optional):</label>
        <input type="number" id="id_age" name="age" min="0" value="{{ form.age.value|default:'' }}">
      </div>
      <div class="form-group">
        <label for="id_gender">Gender:</label>
        <select id="id_gender" name="gender">
          {# --- MODIFIED GENDER SELECT LOGIC --- #}
          {# Add a default option that represents 'empty' or 'unknown' #}
          {# If the field has no value OR the value is empty string, select this option #}
          <option value="" {% if not form.gender.value %}selected{% endif %}>Select Gender</option>
          {% for value, display in form.gender.field.choices %}
            {# If the form value matches the option value, mark it as selected #}
            {# Ensure we compare against the actual value Django provides #}
            <option value="{{ value }}" {% if form.gender.value|stringformat:"s" == value|stringformat:"s" %}selected{% endif %}>{{ display }}</option>
          {% endfor %}
        </select>
      </div>


      {# Existing Fields #}
      <div class="form-group">
    <label for="{{ form.event_date.id_for_label }}">
     {% if report_type == 'Lost' %}Date Lost:{% else %}Date Found:{% endif %}
    </label>
    {{ form.event_date }}
    <small>Approximate date the event occurred.</small>
   </div>
      <div class="form-group">
        <label for="id_pet_type">Pet Type:</label>
        <input type="text" id="id_pet_type" name="pet_type" value="{{ form.pet_type.value|default:'' }}" required>
      </div>
      <div class="form-group">
        <label for="id_breed">Breed (Optional):</label>
        <input type="text" id="id_breed" name="breed" value="{{ form.breed.value|default:'' }}">
      </div>
      <div class="form-group">
        <label for="id_color">Color:</label>
        <input type="text" id="id_color" name="color" value="{{ form.color.value|default:'' }}" required>
      </div>
      
      {# NEW FIELD: Health Information #}
      <div class="form-group">
        <label for="{{ form.health_information.id_for_label }}">Health Information (Optional):</label>
        {{ form.health_information }}
        <small>Known medical issues, required medications, temperament, etc.</small>
      </div>
      
      {# NEW FIELD: Injury (Conditional for Found reports) #}
      {% if report_type == 'Found' %}
      <div class="form-group">
        <label for="{{ form.injury.id_for_label }}">Observed Injury (Optional):</label>
        {{ form.injury }}
        <small>Describe any visible injuries, limps, or signs of distress on the pet you found.</small>
      </div>
      {% endif %}

      <div class="form-group">
        <label for="id_pet_image">Pet Image:</label>
        <input type="file" id="id_pet_image" name="pet_image" accept="image/*" required>
      </div>
      <div class="form-group">
        <label for="id_location">Location:</label>
        <input type="text" id="id_location" name="location" value="{{ form.location.value|default:'' }}" required>
        <small>e.g., "Central Park, NYC" or "Near Main Street and Elm Avenue"</small>
      </div>
      <div class="form-group">
        <label for="id_contact_info">Contact Info:</label>
        <input type="text" id="id_contact_info" name="contact_info" value="{{ form.contact_info.value|default:'' }}" required>
        <small>Your phone number or email address</small>
      </div>

      <button type="submit" class="btn btn-primary btn-full">Submit Report</button>
    </form>
  </div>
</section>
{% endblock %}

